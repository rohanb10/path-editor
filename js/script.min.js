var simplecopy=function(){var e=document,t,o,n,l=false,a=e.createElement("div");function r(r){if(!t)t=e.body;a.innerText=r;t.appendChild(a);n=i(a);o=e.execCommand("copy",l,null);t.removeChild(a);return n&&o}function i(o){var n,a,r=window.getSelection,i=t.createTextRange;if(i){n=i();n.moveToElementText(o);n.select();return!l}else if(r){a=r();n=e.createRange();n.selectNodeContents(o);a.removeAllRanges();a.addRange(n);return!l}else{return l}}return r}();function downloadTypeChanged(e){document.querySelectorAll("#download-format option").forEach(e=>{e.disabled=false});document.getElementById(`nl`).classList.remove("hidden");document.getElementById(`option_clipboard`).selected=true;if(e.options[e.selectedIndex].value==="polyline"){document.getElementById(`nl`).classList.add("hidden");document.getElementById(`option_csv`).disabled=true;document.getElementById(`option_arr`).disabled=true;document.getElementById(`option_obj`).disabled=true}else{document.getElementById(`option_txt`).disabled=true}downloadFormatChanged(document.getElementById("download-format"))}function downloadFormatChanged(e){var t=e.options[e.selectedIndex];if(t.value==="clip"||t.value==="csv"){document.getElementById("new_lines").checked=true;document.getElementById("new_lines").disabled=true}else{document.getElementById("new_lines").disabled=false}}function downloadPath(){var e=document.getElementById("download-type").value;var t=document.getElementById("download-format");var o=document.querySelector(".clipboard-hidden");if(e==="polyline"){if(t.value==="clip")writeToClipboard(getPolylineFromPath());if(t.value==="txt")writeToFile(getPolylineFromPath(),"polyline.txt")}if(e==="cords"){var n=document.getElementById("new_lines").checked;var l=getCordsFromPath(path);if(t.value==="clip")writeToClipboard(exportCords(l,"arr",n));if(t.value==="csv")writeToFile(exportCords(l,"csv"),"polyline.csv");if(t.value==="arr")writeToFile(exportCords(l,"arr",n),"polyline_array.txt");if(t.value==="obj")writeToFile(exportCords(l,"obj",n),"polyline_object.txt")}}function writeToClipboard(e){toast("Copied to clipboard!",3e3);simplecopy(e)}function writeToFile(e,t){var o=Object.assign(document.createElement("a"),{className:"export-hidden",href:`data:text/plain;charset=utf-8,${encodeURIComponent(e)}`,download:t});toast("Downloading "+t);document.body.appendChild(o);o.click();document.body.removeChild(o)}var defaultMapOptions={zoom:2,maxZoom:18,minZoom:2,mapType:"roadmap",zoomControl:true,center:{lat:0,lng:0},precision:5,disableDoubleClickZoom:true,clickableIcons:false,fullscreenControl:false,strokeColorNum:3,styles:{featureType:"poi.business",stylers:[{visibility:"off"}]}};var mapOptions={};function loadPrefs(){document.getElementById("min-zoom").value=mapOptions.minZoom;document.getElementById("max-zoom").value=mapOptions.maxZoom;document.getElementById("cord-precision").value=mapOptions.precision;document.getElementById("map-type").selectedIndex=mapOptions.mapType;document.getElementById("path-color").dataset.color=mapOptions.strokeColorNum;document.querySelector(`.color-picker-tooltip .color-square[data-color="${mapOptions.strokeColorNum}"]`).classList.add("selected");document.getElementById("zoom-control").checked=mapOptions.zoomControl}function updatePrefs(){var e={};var t=parseInt(document.getElementById("min-zoom").value);var o=parseInt(document.getElementById("max-zoom").value);if(t>=o){o=t+1}if(mapOptions.minZoom!==t)e.minZoom=t;if(mapOptions.maxZoom!==o)e.maxZoom=o;var n=parseInt(document.getElementById("cord-precision").value);if(mapOptions.precision!==n)e.precision=n;var l=document.getElementById("zoom-control").checked;if(mapOptions.zoomControl!==l)e.zoomControl=l;var a=document.getElementById("map-type");var r=a.options[a.selectedIndex].value;if(mapOptions.mapType!==r){map.setMapTypeId(a.options[a.selectedIndex].value);e.mapType=a.selectedIndex}e.strokeColorNum=document.getElementById("path-color").dataset.color;if(path)path.setOptions({strokeColor:getColorFromNum(e.strokeColorNum)});map.setOptions(e);Object.keys(e).forEach(t=>{cookie.set(t,e[t],{expires:14})});Object.assign(mapOptions,e);closeDrawer()}function openDrawer(e){var t=document.querySelector(".footer");if(t.classList.contains("open"))return;t.classList.add("open");e.classList.add("open");document.getElementById(e.dataset.name).classList.add("open");if(e.dataset.name==="preferences")loadPrefs()}function closeDrawer(){document.querySelectorAll(".footer, .drawer div, .handle a").forEach(e=>e.classList.remove("open"))}function getColorFromNum(e){var t=getComputedStyle(document.querySelector(`.color-square[data-color="${e}"]`)).backgroundColor;return"#"+t.match(/\d+/g).map(y=(e=>(+e<16?"0":"")+(+e).toString(16))).join("")}function changePathColor(e){document.getElementById("path-color").dataset.color=e.dataset.color;document.querySelector(".color-picker-tooltip .color-square.selected").classList.remove("selected");e.classList.add("selected")}function resetUploadForm(){console.log("why");var e=document.getElementById("polyline-file");e.value="";e.nextElementSibling.querySelector("span:first-of-type").classList.remove("uploaded");e.nextElementSibling.querySelector("span:last-of-type").innerText="Upload a text file";e.disabled=false;var t=document.getElementById("polyline-text");t.value="";t.disabled=false;textInputLength=-1;document.querySelectorAll(".step").forEach(e=>e.classList.remove("complete"));hideNextButton(1,true)}var textInputLength=-1;function uploaded(e,t){switch(e){case"file":t.nextElementSibling.querySelector("span:last-of-type").innerText=t.value.split(String.fromCharCode(92)).pop();t.nextElementSibling.querySelector("span:first-of-type").classList.add("uploaded");goToStep(1.5,false);break;case"paste":document.getElementById("polyline-file").disabled=true;setTimeout(()=>goToStep(1.5),100);break;case"text":if(t.value.length>0){document.getElementById("polyline-file").disabled=true;if(t.value.length!==textInputLength){goToStep(1,textInputLength.length<=0)}hideNextButton(1,false);return}console.log("hi");resetUploadForm();break;default:break}document.querySelector(".reset").classList.remove("hidden")}function resetAll(){console.log("hi");if(confirm("Are you sure you want to reset?\r\nAll changes will be lost.\r\n"))goToStep(1,true)}function hideNextButton(e,t){var o=document.querySelector(`.step[data-step="${e}"] .next`);if(t)o.classList.add("hidden");if(!t)o.classList.remove("hidden")}function changeNextButton(e,t=null,o=null,n=false){var l=document.querySelector(`.step[data-step="${e}"] .next`);if(t!==null)l.firstElementChild.innerHTML=`<span>${t}</span>`;if(o!==null)l.firstElementChild.onclick=(()=>goToStep(o));if(n)l.classList.add("hidden");if(!n)l.classList.remove("hidden")}function showStep(e){var t=document.querySelector(".step.active");var o=document.querySelector(`.step[data-step="${e}"]`);t.classList.add("complete");t.classList.remove("active");o.classList.add("active")}var input;function goToStep(e,t=false){var o=parseInt(document.querySelector(".step.active").dataset.step);console.log(o,e);if(e===1){showStep(1);changeNextButton(1,"Preview",1.5);if(t){destroyPath();resetUploadForm()}if(pathModified){document.getElementById("polyline-file").disabled=true;document.getElementById("polyline-text").disabled=true;goToStep(1.5);return}}if(e===1.5){if(document.getElementById("polyline-file").value.length>0){toast("Generating Preview");var n=new FileReader;n.onload=(()=>{l=unescapePoly(n.result);Object.assign(document.getElementById("polyline-text"),{disabled:true,value:l});if(!pathModified)render(l,true)});n.readAsText(document.getElementById("polyline-file").files[0])}else if(document.getElementById("polyline-text").value.length>0){toast("Generating Preview");var l=document.getElementById("polyline-text").value.trim();l=unescapePoly(l);textInputLength=l.length;if(!pathModified)render(l,true)}changeNextButton(1,"Next",2);hideNextButton(1,false)}if(e===2&&o!==2){toast("Loading vertices",Math.ceil(path.getPath().length/250)*500);showStep(2);path.setOptions({editable:true});toggleListeners(true);fitPathInViewport()}if(e===3&&o!==3){toast("Saving Changes");showStep(3);path.setOptions({editable:false});destroyEditingTools();toggleListeners(false);fitPathInViewport()}}function toast(e,t=1e3){var o=document.querySelector(".toaster");o.firstElementChild.innerHTML=e;o.classList.add("toast");setTimeout(()=>o.classList.remove("toast"),t+501)}var map,path=null,hoverPoly=null,preview=null,shape=null,shapeBounds=[];function initialize(){setMapOptions();map=new google.maps.Map(document.getElementById("map"),mapOptions);map.addListener("tilesloaded",()=>{setTimeout(()=>document.querySelectorAll(".gm-style-cc").forEach(e=>e.style.display="none"),150)})}function setMapOptions(){var e=["minZoom","maxZoom","precision","mapType","zoomControl","strokeColorNum"];Object.assign(mapOptions,defaultMapOptions);if(Object.keys(cookie.all()).length===0){e.forEach(e=>cookie.set(e,defaultMapOptions[e],{expires:14}))}else{Object.keys(cookie.all()).forEach(e=>{var t=cookie.get(e);mapOptions[e]=t==="true"?true:t==="false"?false:t})}}function fitPathInViewport(){var e=new google.maps.LatLngBounds;path.getPath().forEach(function(t){e.extend(t)});map.fitBounds(e)}function render(e,t){if(path!==null)path.setMap(null);path=new google.maps.Polyline({path:getLatLngArrayFromPolyline(e,mapOptions.precision),strokeColor:getColorFromNum(mapOptions.strokeColorNum),strokeOpacity:1,strokeWeight:4,map:map});fitPathInViewport()}function toggleListeners(e){if(e){google.maps.event.addListener(path,"click",e=>{if(e.vertex==undefined)return;removeVertex(path.getPath(),e.vertex)});google.maps.event.addListener(map,"rightclick",e=>drawShape(e))}else{google.maps.event.clearListeners(map,"click");google.maps.event.clearListeners(map,"rightclick");google.maps.event.clearListeners(map,"mousemove")}}function getLatLngArrayFromPolyline(e,t=5){var o=polyline.decode(e,t);var n=[];o.forEach(e=>{n.push(new google.maps.LatLng(e[0],e[1]))});return n}function escapePoly(e){return e.split(String.fromCharCode(92)).join(String.fromCharCode(92,92))}function unescapePoly(e){return e.split(String.fromCharCode(92,92)).join(String.fromCharCode(92))}function destroyEditingTools(){if(preview!==null){preview.remove();preview=null}if(hoverPoly!==null){hoverPoly.setMap(null);hoverPoly=null}if(shape!==null){shape.setMap(null);shape=null}shapeBounds=[]}function destroyPath(){destroyEditingTools();toggleListeners(false);if(path!=null){path.setMap(null);path=null}pathModified=false}function getPolylineFromPath(){var e=polyline.encode(getCordsFromPath(path));e=e.split(String.fromCharCode(92)).join(String.fromCharCode(92,92));return e}function getCordsFromPath(e,t=5){var o=[];var n=e.getPath();for(var l=0;l<n.length;l++){o.push([n.getAt(l).lat().toFixed(t),n.getAt(l).lng().toFixed(t)])}return o}function exportCords(e,t,o=false){var n="";console.log(t);if(t==="csv"){e.forEach(e=>n+=e+"\r\n");return n}if(t==="arr"){e.forEach(e=>{n+="["+e+"],"+(o?"\r\n":"")})}if(t==="obj"){e.forEach(e=>{n+="{x:"+e[0]+", y:"+e[1]+"},"+(o?"\r\n":"")})}if(!o&&n.charAt(n.length-1)===",")n=n.slice(0,-1);if(o&&n.charAt(n.length-2)===",")n=n.slice(0,-2)+"\r\n";return n}var pathModified=false;function removeVertex(e,t){if(!e||t==undefined)return;pathModified=true;e.removeAt(t)}function drawShape(e){if(path==undefined)return;if(shapeBounds.length==2){shapeBounds=[];shape.setMap(null);return}var t=[parseFloat(e.latLng.lat().toFixed(5)),parseFloat(e.latLng.lng().toFixed(5))];shapeBounds.push(t);if(shapeBounds.length==1){preview=google.maps.event.addListener(map,"mousemove",e=>{if(hoverPoly)hoverPoly.setMap(null);var o=[parseFloat(e.latLng.lat().toFixed(5)),parseFloat(e.latLng.lng().toFixed(5))];hoverPoly=new google.maps.Polygon({map:map,fillOpacity:.1,strokeWeight:.9,strokeOpacity:.5,fillColor:"#FFF",strokeColor:"#FFF",clickable:false,paths:[{lat:t[0],lng:t[1]},{lat:t[0],lng:o[1]},{lat:o[0],lng:o[1]},{lat:o[0],lng:t[1]}]})})}if(shapeBounds.length==2){hoverPoly.setMap(null);preview.remove();shape=new google.maps.Polygon({map:map,fillOpacity:.3,strokeWeight:.9,clickable:true,fillColor:"#FFF",strokeColor:"#FFF",editable:true,paths:[{lat:shapeBounds[0][0],lng:shapeBounds[0][1]},{lat:shapeBounds[0][0],lng:shapeBounds[1][1]},{lat:shapeBounds[1][0],lng:shapeBounds[1][1]},{lat:shapeBounds[1][0],lng:shapeBounds[0][1]}]});google.maps.event.addListener(shape,"click",()=>{var e=path.getPath();for(var t=0;t<e.length;t++){var o=new google.maps.LatLng(e.getAt(t).lat(),e.getAt(t).lng());if(google.maps.geometry.poly.containsLocation(o,shape))removeVertex(e,t)}})}}google.maps.event.addDomListener(window,"load",initialize);